
trigger:
- master

pool:
  vmImage: 'ubuntu-latest'

steps:


- task: DockerCompose@0
  inputs:
    containerregistrytype: 'Azure Container Registry'
    azureSubscription: 'Azure for Students(89332acc-e99a-4a6e-8d22-d9115e1c77d1)'
    azureContainerRegistry: '{"loginServer":", "id" : "/subscriptions/89332acc-e99a-4a6e-8d22-d9115e1c77d1/resourceGroups/appsvc_linux_centralus/providers/Microsoft.ContainerRegistry/registries/LakeSideDockerRegistry"}'
    dockerComposeFile: '**/docker-compose.yml'
    dockerComposeFileArgs: |
      COMPOSE_DOCKER_CLI_BUILD=1
      DOCKER_BUILDKIT=1
    action: 'Run a Docker Compose command'
    dockerComposeCommand: 'build'

- task: DockerCompose@0
  inputs:
    containerregistrytype: 'Azure Container Registry'
    azureSubscription: 'Azure for Students(89332acc-e99a-4a6e-8d22-d9115e1c77d1)'
    azureContainerRegistry: '{"loginServer":"lakesidedockerregistry.azurecr.io", "id" : "/subscriptions/89332acc-e99a-4a6e-8d22-d9115e1c77d1/resourceGroups/appsvc_linux_centralus/providers/Microsoft.ContainerRegistry/registries/LakeSideDockerRegistry"}'
    dockerComposeFile: '**/docker-compose.yml'
    dockerComposeFileArgs: 'COMPOSE_DOCKER_CLI_BUILD=1 DOCKER_BUILDKIT=1'
    action: 'Push services'

- task: AzureRmWebAppDeployment@4
  inputs:
    ConnectionType: 'AzureRM'
    azureSubscription: 'Azure for Students(89332acc-e99a-4a6e-8d22-d9115e1c77d1)'
    appType: 'webAppContainer'
    WebAppName: 'lakesidedocker'
    deployToSlotOrASE: true
    ResourceGroupName: 'docker-rg'
    SlotName: 'production'
    DockerNamespace: 'lakesidedockerregistry.azurecr.io'
    DockerRepository: 'severindellspergerlakesidemutual_app'